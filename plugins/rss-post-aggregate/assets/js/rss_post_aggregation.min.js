/**
 * RSS Post Aggregation - v0.1.0 - 2014-08-29 | http://webdevstudios.com | Copyright (c) 2014; | Licensed GPLv2+
 */
window.RSS_Post_Aggregation=function(e,t,s,n){"use strict";function i(){var e={},t=function(t,s,i){"boolean"==typeof s&&(i=s);var o=s?s.selector+" "+t:t;if(n===e[o]||i){var r=s?s.find(t):jQuery(t);e[o]=r}return e[o]};return t}function o(){o.history=o.history||[],o.history.push(arguments),e.console&&l.debug&&e.console.log(Array.prototype.slice.call(arguments))}var r=e.Backbone,l=e.RSSPost_l10n,u={Post:{},Posts:{},Views:{Row:{},Modal:{}},PostsView:{},$:new i,feeds:l.feeds};return u.Post=r.Model.extend({defaults:{index:0,url:"",img:"",title:"",urlhost:"",date:""},idAttribute:"index"}),u.Posts=r.Collection.extend({model:u.Post}),u.Views.Modal=r.View.extend({events:{"click #find-posts-submit":"submit"},optionsTemplate:wp.template("rssfeedoption"),initialize:function(){this.$feedSelector=this.$("#select-feed"),this.$response=this.$("#find-posts-response"),this.listenTo(this,"render",this.render),this.render()},setupSelect:function(){var e=this,t="",s="";return _.each(u.feeds,function(n){s=s?s:n,t+=e.optionsTemplate({url:n})}),this.$feedSelector.html(t),this.fetchAndPopulate(s),this},fetchAndPopulate:function(e){o("feed_url",e);var t=this;s.ajax({type:"post",dataType:"json",url:l.ajaxurl,data:{action:"rss_get_data",feed_url:e},success:function(e){e.success?(o("response.success",e),t.populateItems(e.data)):o("response",e)}})},populateItems:function(e){this.collection=new u.Posts(e),this.optionsTemplate({url:e})},submit:function(e){e.preventDefault()},render:function(){this.setupSelect();var e=t.createDocumentFragment();this.$response.html(e)}}),u.Views.Row=r.View.extend({tagName:"tr",template:wp.template("rssitem"),id:function(){return"rss-item-"+this.model.get("index")},className:function(){return"found-posts "+(0===this.model.get("index")%2?"":"alternate")},attributes:function(){return{title:this.model.get("url"),"data-img":this.model.get("img")}},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),u.init=function(){o(u),o("l10n.feeds",l.feeds);var e=_.toArray(l.feeds);return e.length?(u.PostsView=new u.Views.Modal({el:"#find-posts"}),n):(o("no feeds!"),n)},s(t).ready(u.init),u}(window,document,jQuery);